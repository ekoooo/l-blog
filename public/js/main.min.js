!function(i){i.fn.message=function(t,e){var a="emoji";2===e?a="warning":3===e&&(a="delete");var n=i('<span class="message"><i class="iconfont icon-'+a+'"></i> '+t+"</span>");i("body").append(n),n.animate({opacity:1,top:"40%"},{duration:300,done:function(){setTimeout(function(){n.animate({opacity:0,top:"0"},{duration:500,easing:"swing",done:function(){n.remove()}})},2e3)}})},i.fn.getQueryString=function(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)","i"),a=window.location.search.substr(1).match(e);return null!=a?unescape(a[2]):null}}(jQuery),$(function(){function t(){var y=this,e="#comment-tool",p="#post-id",u="#parent-id",h="#reply-id",a="#author-name",n="#author-mail",r="#author-site",l="#md-editor",f="#send-comment",g="#load-editor",k=".comment-more",v=".reply-button";this.listLoading=!1;function _(t){function e(t){return""===t||null==t}var a,n;return e(t.postId)?"参数错误":e(t.name)?"请输入昵称":e(t.mail)?"请输入邮箱":e($.trim(t.content))?"请输入内容":t.name.length<2||16<t.name.length?"昵称必须 2 到 16 位":e(t.mail)||(a=t.mail,/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(a.toLowerCase()))?!e(t.site)&&(n=t.site,!/^(?:\w+:)?\/\/([^\s\.]+\.\S{2}|localhost[\:?\d]*)\S*$/.test(n))&&"网址格式不正确":"邮箱格式不正确"}function b(t,e){return'<li class="comment-list-item" id="post-comment-'+t.id+'">  <div>    <p class="head">      <span class="name"><a target="_blank" href="'+t.author_site+'">'+t.author+'</a></span>      <span>回复</span>      <span class="name"><a target="_blank" href="'+t.reply_to_author_site+'">'+t.reply_to_author+'</a></span>      <span>于</span>      <span class="time">'+t.create_time+'</span>    </p>    <div class="content markdown-body">'+t.content+'</div>    <span id="reply-button-'+t.id+'"          data-parent-id="'+e.id+'"          data-author="'+encodeURI(t.author)+'"          data-author-site="'+encodeURI(t.author_site)+'"          data-reply-id="'+t.id+'" class="reply-button">回复TA</span>  </div></li>'}this.initEditor=function(){function c(){$("#parent-id").val(null),$("#reply-id").val(null),$(".comment-container").removeClass("fixed"),m&&m.resize("200%")}var i,o,d,t,m=null,s=$(e);s.length&&(i=$(a),o=$(n),d=$(r),!window.localStorage||(t=JSON.parse(window.localStorage.getItem("comment_info")))&&(i.val(t.name),o.val(t.mail),d.val(t.site)),$(f).on("click",function(t){t.preventDefault();var s=$(this),r=s.val();s.attr("disabled",!0).val("发送中...");var e,a,n,l={postId:$(p).val(),parentId:$(u).val(),replyId:$(h).val(),name:i.val(),mail:o.val(),site:d.val(),content:m&&m.getPreviewedHTML()};a=function(t){var e,a,n,i,o;s.attr("disabled",!1).val(r),t&&(200===t.code?(t.info.commentCheck?$().message("评论成功，需管理员审核才能展示"):($().message("评论成功"),l.parentId&&l.replyId?(c(),e=$("#reply-button-"+l.replyId),a=b({id:t.info.id,content:t.info.childInfo.content,create_time:t.info.childInfo.createTime,post_id:l.postId,author_site:l.site,author:l.name,reply_to_author_site:decodeURI(e.data("authorSite")),reply_to_author:decodeURI(e.data("author"))},{id:l.parentId}),n="#post-comment-"+l.parentId,(i=$(n+" .comment-list-child")).length?i.append(a):$(n).append('<ul class="comment-list-child">'+a+"</ul>"),(o=$(".comment-info-count")).text(parseInt(o.text())+1)):y.initCommentList(!0)),m.setMarkdown(""),window.localStorage&&window.localStorage.setItem("comment_info",JSON.stringify({name:l.name,mail:l.mail,site:l.site}))):$().message(t.message))},(n=_(e=l))?($().message(n),a(!1)):$.ajax({url:"/comment",method:"POST",data:e,dataType:"json",success:function(t){a(t)},error:function(){a(!1)}})}),$(g).on("click",function(n){var t,e;n.preventDefault(),$(n.currentTarget).val("正在加载编辑器..."),t=function(){var t,e;t=function(){var t,e,a;t=function(t){$(n.currentTarget).hide(),$().message("编辑器加载成功"),$("html, body").animate({scrollTop:s.offset().top-70+"px"},{duration:500,easing:"swing"}),m=t},e=l,(a=window.editormd(e.replace("#",""),{width:"100%",height:150,path:"/manager/static/editor.md/lib/",placeholder:"请输入留言，支持 Markdown...",lineNumbers:!1,saveHTMLToTextarea:!0,watch:!0,toolbar:!1,taskList:!0})).on("load",function(){t&&t(a),this.resize("200%",null)})},(e=document.createElement("script")).type="text/javascript",e.src="/manager/static/editor.md/editormd.min.js",e.onload=e.onreadystatechange=function(){t&&t()},document.body.appendChild(e)},(e=document.createElement("link")).type="text/css",e.rel="stylesheet",e.href="/manager/static/editor.md/css/editormd.min.css",e.onload=e.onreadystatechange=function(){t&&t()},$(e).insertAfter($("title"))}),$(r).on("blur",function(){var t=$(this).val();0<t.length&&0!==t.indexOf("http://")&&0!==t.indexOf("https://")&&0!==t.indexOf("tfp://")&&$(this).val("http://"+t)}),$(k).on("click",function(){y.listLoading||(y.listLoading=!0,y.initCommentList())}),$(".comment-list").on("click",v,function(t){var e,a;e=this.dataset.parentId,a=this.dataset.replyId,$("#parent-id").val(e),$("#reply-id").val(a),$(".comment-container").addClass("fixed"),m&&m.resize("200%")}),$(".comment-container").on("click",function(t){$(t.target).hasClass("comment-container")&&c()}))},this.initCommentList=function(h){var t,e,f,g,v=$(".comment-info");v.length&&(t=v.attr("data-post-id"),e=v.attr("data-page"),f=$(k),g=f.text(),f.text("加载中..."),h&&(e=-1),$.ajax({url:"/comment?page="+ ++e+"&postId="+t,method:"GET",dataType:"json",success:function(t){if(200===t.code){var e=t.pageSize,a=t.list,n=parseInt((t.totalCount+e-1)/e);v.attr("data-page",t.pageId),n<=t.pageId+1?f.hide():f.show(),$(".comment-info-count").text(t.count);var i=$(".comment-list"),o=void 0;h?(i.empty(),o=0,v.attr("data-count",a.length)):(o=Number(v.attr("data-count")),v.attr("data-count",o+a.length));for(var s=0;s<a.length;s++){for(var r,l=a[s],c="",d=0;d<l.childList.length;d++)r=l.childList[d],c+=b(r,l);c.length&&(c='<ul class="comment-list-child">'+c+"</ul>"),i.append((p=o+s+1,u=c,'<li class="comment-list-item" id="post-comment-'+(m=l).id+'">  <div>    <p class="head">      <span class="name"><a target="_blank" href="'+m.author_site+'">'+p+"# "+m.author+'</a></span>      <span>于</span>      <span class="time">'+m.create_time+'</span>      <span>回复：</span>    </p>    <div class="content markdown-body">'+m.content+'</div>    <span id="reply-button-'+m.id+'"          data-parent-id="'+m.id+'"          data-author="'+encodeURI(m.author)+'"          data-author-site="'+encodeURI(m.author_site)+'"          data-reply-id="'+m.id+'" class="reply-button">回复TA</span>  </div>'+u+"</li>"))}}var m,p,u;y.listLoading=!1,f.text(g)}}))}}var e,a,n;$(".markdown-toc a").on("click",function(t){t.preventDefault();var e=decodeURI(this.href.split("#")[1]);$("html, body").animate({scrollTop:$('.reference-link[name="'+e+'"]').offset().top-70+"px"},{duration:500,easing:"swing"})}),e=$(".post-box").attr("data-post-id"),$(".post-vote .post-vote-item").on("click",function(){var n,i;$(".post-vote-item i.active").length?$().message("您已投过票了！"):(i=$(n=this).hasClass("unlike"),$.ajax({type:"POST",url:(i?"/post/unlike/":"/post/like/")+e,success:function(t){var e,a;200===t.code?(e=$(n).find("i"),a=i?$(".unlike-num"):$(".like-num"),i?e.removeClass("icon-emoji").addClass("pink active icon-emoji_fill"):e.removeClass("icon-praise").addClass("pink active icon-praise_fill"),a.text(Number(a.eq(0).text())+1),$().message("投票成功！")):$().message(t.message)},dataType:"json"}))}),$('.markdown-body a:not([class^="toc-level"])').attr("target","_blank"),$(".sidebar-op").on("click",function(){var o=$(".sidebar");o.attr("data-init")||$.ajax({method:"GET",url:"/sidebar",dataType:"json",success:function(t){if(200===t.code){var e=t.info;$(".author-ch-name").text(e.ch_name),$(".author-en-name").text(e.en_name),$(".collection-post-num").text(e.post_num),$(".collection-category-num").text(e.post_category_num),$(".collection-tag-num").text(e.post_tag_num);for(var a=$(".author-links"),n=0;n<e.links.length;n++)a.append('<a target="_blank" href="'+e.links[n].href+'">'+e.links[n].label+"</a>");for(var i=$(".friends-links"),n=0;n<e.friends_links.length;n++)i.append('<a target="_blank" href="'+e.friends_links[n].href+'">'+e.friends_links[n].label+"</a>");o.attr("data-init","1")}else $().message(t.message)}}),$("body").toggleClass("sidebar-open")}),$(".sidebar .author-avatar img").on("mouseover mouseleave",function(t){$(this).attr("src","mouseover"===t.type?"/img/logo.gif":"/img/logo_1.png")}),$(".nav .switch").on("click",function(){$(this).parent().toggleClass("active")}),(a=new t).initEditor(),a.initCommentList(!0),(n=$("#search-input")).length&&(n.val($().getQueryString("keyWord")),n.bind("keypress",function(t){var e;"Enter"===event.key&&(t.preventDefault(),0!==(e=t.currentTarget.value).length?window.location="/search?do=1&keyWord="+escape(e):$().message("请输入关键字搜索"))}))});
//# sourceMappingURL=main.min.js.map
