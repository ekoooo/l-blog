!function(o){o.fn.message=function(t,e){var a="emoji";2===e?a="warning":3===e&&(a="delete");var n=o('<span class="message"><i class="iconfont icon-'+a+'"></i> '+t+"</span>");o("body").append(n),n.animate({opacity:1,top:"40%"},{duration:300,done:function(){setTimeout(function(){n.animate({opacity:0,top:"0"},{duration:500,easing:"swing",done:function(){n.remove()}})},2e3)}})}}(jQuery),$(function(){function t(){var u=this;this.listLoading=!1;function d(t){function e(t){return""===t||null==t}var a,n;return e(t.postId)?"参数错误":e(t.name)?"请输入昵称":e(t.mail)?"请输入邮箱":e($.trim(t.content))?"请输入内容":t.name.length<2||16<t.name.length?"昵称必须 2 到 16 位":e(t.mail)||(a=t.mail,/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(a.toLowerCase()))?!e(t.site)&&(n=t.site,!/^(?:\w+:)?\/\/([^\s\.]+\.\S{2}|localhost[\:?\d]*)\S*$/.test(n))&&"网址格式不正确":"邮箱格式不正确"}var e="#comment-tool",p="#post-id",f="#parent-id",a="#author-name",n="#author-mail",i="#author-site",s="#md-editor",g="#send-comment",v="#load-editor",h=".comment-more";this.initEditor=function(){var r,l,c,t,m=null,o=$(e);o.length&&(r=$(a),l=$(n),c=$(i),!window.localStorage||(t=JSON.parse(window.localStorage.getItem("comment_info")))&&(r.val(t.name),l.val(t.mail),c.val(t.site)),$(g).on("click",function(t){t.preventDefault();var e=$(this),a=e.val();e.attr("disabled",!0).val("发送中...");var n,o,i,s={postId:$(p).val(),parentId:$(f).val(),name:r.val(),mail:l.val(),site:c.val(),content:m&&m.getPreviewedHTML()};o=function(t){e.attr("disabled",!1).val(a),t&&(200===t.code?(t.info.commentCheck?$().message("评论成功，需管理员审核才能展示"):($().message("评论成功"),u.initCommentList(!0)),m.setMarkdown(""),window.localStorage&&window.localStorage.setItem("comment_info",JSON.stringify({name:s.name,mail:s.mail,site:s.site}))):$().message(t.message))},(i=d(n=s))?($().message(i),o(!1)):$.ajax({url:"/comment",method:"POST",data:n,dataType:"json",success:function(t){o(t)},error:function(){o(!1)}})}),$(v).on("click",function(n){var t,e;n.preventDefault(),$(n.currentTarget).val("正在加载编辑器..."),t=function(){var t,e;t=function(){var t,e,a;t=function(t){$(n.currentTarget).hide(),$().message("编辑器加载成功"),$("html, body").animate({scrollTop:o.offset().top-70+"px"},{duration:500,easing:"swing"}),m=t},e=s,(a=window.editormd(e.replace("#",""),{width:"100%",height:150,path:"/manager/static/editor.md/lib/",placeholder:"请输入留言，支持 Markdown...",lineNumbers:!1,saveHTMLToTextarea:!0,watch:!0,toolbar:!1,taskList:!0})).on("load",function(){t&&t(a),this.resize("200%",null)})},(e=document.createElement("script")).type="text/javascript",e.src="/manager/static/editor.md/editormd.min.js",e.onload=e.onreadystatechange=function(){t&&t()},document.body.appendChild(e)},(e=document.createElement("link")).type="text/css",e.rel="stylesheet",e.href="/manager/static/editor.md/css/editormd.min.css",e.onload=e.onreadystatechange=function(){t&&t()},$(e).insertAfter($("title"))}),$(i).on("blur",function(){var t=$(this).val();0<t.length&&0!==t.indexOf("http://")&&0!==t.indexOf("https://")&&0!==t.indexOf("tfp://")&&$(this).val("http://"+t)}),$(h).on("click",function(){u.listLoading||(u.listLoading=!0,u.initCommentList())}))},this.initCommentList=function(l){var t,e,c,m,d=$(".comment-info");d.length&&(t=d.attr("data-post-id"),e=d.attr("data-page"),c=$(h),m=c.text(),c.text("加载中..."),l&&(e=-1),$.ajax({url:"/comment?page="+ ++e+"&postId="+t,method:"GET",dataType:"json",success:function(t){if(200===t.code){var e=t.pageSize,a=t.list,n=parseInt((t.totalCount+e-1)/e);d.attr("data-page",t.pageId),n<=t.pageId+1?c.hide():c.show(),$(".comment-info-count").text(t.totalCount);var o=$(".comment-info-list"),i=void 0;l?(o.empty(),i=0,d.attr("data-count",a.length)):(i=Number(d.attr("data-count")),d.attr("data-count",i+a.length));for(var s=0;s<a.length;s++){var r=a[s];o.append('<li class="comment-info-item" id="post-comment-'+r.post_id+'">  <div class="comment-info-box">    <div class="comment-info-row">      <a href="javascript:void(0);" class="comment-info-anchor"># '+(i+s+1)+' </a>      <span class="blod">        <a target="_blank" href="'+r.author_site+'">'+r.author+"</a>      </span>      <span>于 "+r.create_time+'</span>      <span>回复到：</span>    </div>    <div class="comment-info-row">      <div class="content markdown-body">'+r.content+"</div>    </div>  </div></li>")}}u.listLoading=!1,c.text(m)}}))}}var e,a;$(".markdown-toc a").on("click",function(t){t.preventDefault();var e=decodeURI(this.href.split("#")[1]);$("html, body").animate({scrollTop:$('.reference-link[name="'+e+'"]').offset().top-70+"px"},{duration:500,easing:"swing"})}),e=$(".post-box").attr("data-post-id"),$(".post-vote .post-vote-item").on("click",function(){var n,o;$(".post-vote-item i.active").length?$().message("您已投过票了！"):(o=$(n=this).hasClass("unlike"),$.ajax({type:"POST",url:(o?"/post/unlike/":"/post/like/")+e,success:function(t){var e,a;200===t.code?(e=$(n).find("i"),a=o?$(".unlike-num"):$(".like-num"),o?e.removeClass("icon-emoji").addClass("pink active icon-emoji_fill"):e.removeClass("icon-praise").addClass("pink active icon-praise_fill"),a.text(Number(a.eq(0).text())+1),$().message("投票成功！")):$().message(t.message)},dataType:"json"}))}),$('.markdown-body a:not([class^="toc-level"])').attr("target","_blank"),$(".sidebar-op").on("click",function(){var i=$(".sidebar");i.attr("data-init")||$.ajax({method:"GET",url:"/sidebar",dataType:"json",success:function(t){if(200===t.code){var e=t.info;$(".author-ch-name").text(e.ch_name),$(".author-en-name").text(e.en_name),$(".collection-post-num").text(e.post_num),$(".collection-category-num").text(e.post_category_num),$(".collection-tag-num").text(e.post_tag_num);for(var a=$(".author-links"),n=0;n<e.links.length;n++)a.append('<a target="_blank" href="'+e.links[n].href+'">'+e.links[n].label+"</a>");for(var o=$(".friends-links"),n=0;n<e.friends_links.length;n++)o.append('<a target="_blank" href="'+e.friends_links[n].href+'">'+e.friends_links[n].label+"</a>");i.attr("data-init","1")}else $.message(t.message)}}),$("body").toggleClass("sidebar-open")}),$(".sidebar .author-avatar img").on("mouseover mouseleave",function(t){$(this).attr("src","mouseover"===t.type?"/img/logo.gif":"/img/logo_1.png")}),$(".nav .switch").on("click",function(){$(this).parent().toggleClass("active")}),(a=new t).initEditor(),a.initCommentList(!0)});
//# sourceMappingURL=main.min.js.map
