!function(e){e.fn.message=function(t,n){var a="emoji";2===n?a="warning":3===n&&(a="delete");var o=e('<span class="message"><i class="iconfont icon-'+a+'"></i> '+t+"</span>");e("body").append(o),o.animate({opacity:1,top:"40%"},{duration:300,done:function(){setTimeout(function(){o.animate({opacity:0,top:"0"},{duration:500,easing:"swing",done:function(){o.remove()}})},2e3)}})}}(jQuery),function(e){function t(t,n){var a=function(t){var n=function(e){return""===e||null===e||void 0===e};return n(t.postId)?"参数错误":n(t.name)?"请输入昵称":n(t.mail)?"请输入邮箱":n(e.trim(t.content))?"请输入内容":t.name.length<4||t.name.length>16?"昵称必须 4 到 16 位":n(t.mail)||function(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e.toLowerCase())}(t.mail)?!n(t.site)&&!function(e){return/^(?:\w+:)?\/\/([^\s\.]+\.\S{2}|localhost[\:?\d]*)\S*$/.test(e)}(t.site)&&"网址格式不正确":"邮箱格式不正确"}(t);a?(e().message(a),n(!1)):e.ajax({url:"/comment",method:"POST",data:t,dataType:"json",success:function(e){n(e)},error:function(){n(!1)}})}e.fn.comment=function(){var n="#comment-tool",a="#post-id",o="#parent-id",i="#author-name",s="#author-mail",r="#author-site",c="#md-editor",l="#load-editor",d=null;e("#send-comment").on("click",function(n){n.preventDefault();var c=e(this),l=c.val();c.attr("disabled",!0).val("发送中..."),t({postId:e(a).val(),parentId:e(o).val(),name:e(i).val(),mail:e(s).val(),site:e(r).val(),content:d&&d.getPreviewedHTML()},function(t){c.attr("disabled",!1).val(l),t&&(200===t.code?e().message("评论成功"):e().message(t.message))})}),e(l).on("click",function(t){t.preventDefault(),function(e){var t=document.createElement("link");t.type="text/css",t.rel="stylesheet",t.href="/manager/static/editor.md/css/editormd.min.css",t.onload=t.onreadystatechange=function(){e&&e()},document.getElementsByTagName("head")[0].appendChild(t)}(function(){!function(e){var t=document.createElement("script");t.type="text/javascript",t.src="/manager/static/editor.md/editormd.min.js",t.onload=t.onreadystatechange=function(){e&&e()},document.body.appendChild(t)}(function(){!function(e,t){var n=window.editormd(t.replace("#",""),{width:"200%",height:150,path:"/manager/static/editor.md/lib/",placeholder:"请输入留言，支持 Markdown...",lineNumbers:!1,saveHTMLToTextarea:!0,watch:!0,toolbar:!1});n.on("load",function(){e&&e(n)})}(function(a){e(t.currentTarget).hide(),e().message("编辑器加载成功"),e("html, body").animate({scrollTop:e(n).offset().top-70+"px"},{duration:500,easing:"swing"}),d=a},c)})})}),e(r).on("blur",function(){var t=e(this).val();t.length>0&&0!==t.indexOf("http://")&&0!==t.indexOf("https://")&&0!==t.indexOf("tfp://")&&e(this).val("http://"+t)})}}(jQuery),$(function(){$(".markdown-toc a").on("click",function(e){e.preventDefault();var t=decodeURI(this.href.split("#")[1]);$("html, body").animate({scrollTop:$('.reference-link[name="'+t+'"]').offset().top-70+"px"},{duration:500,easing:"swing"})}),function(){var e=$(".post-box").attr("data-post-id");$(".post-vote .post-vote-item").on("click",function(){if($(".post-vote-item i.active").length)$().message("您已投过票了！");else{var t=this,n=$(this).hasClass("unlike");$.ajax({type:"POST",url:(n?"/post/unlike/":"/post/like/")+e,success:function(e){if(200===e.code){var a=$(t).find("i"),o=n?$(".unlike-num"):$(".like-num");n?a.removeClass("icon-emoji").addClass("pink active icon-emoji_fill"):a.removeClass("icon-praise").addClass("pink active icon-praise_fill"),o.text(Number(o.eq(0).text())+1),$().message("投票成功！")}else $().message(e.message)},dataType:"json"})}})}(),$('.markdown-body a:not([class^="toc-level"])').attr("target","_blank"),$(".sidebar-op").on("click",function(){var e=$(".sidebar");e.attr("data-init")||$.ajax({method:"GET",url:"/sidebar",dataType:"json",success:function(t){if(200===t.code){var n=t.info;$(".author-ch-name").text(n.ch_name),$(".author-en-name").text(n.en_name),$(".collection-post-num").text(n.post_num),$(".collection-category-num").text(n.post_category_num),$(".collection-tag-num").text(n.post_tag_num);for(var a=$(".author-links"),o=0;o<n.links.length;o++)a.append('<a target="_blank" href="'+n.links[o].href+'">'+n.links[o].label+"</a>");var i=$(".friends-links");for(o=0;o<n.friends_links.length;o++)i.append('<a target="_blank" href="'+n.friends_links[o].href+'">'+n.friends_links[o].label+"</a>");e.attr("data-init","1")}else $.message(t.message)}}),$("body").toggleClass("sidebar-open")}),$(".sidebar .author-avatar img").on("mouseover mouseleave",function(e){$(this).attr("src","mouseover"===e.type?"/img/logo.gif":"/img/logo_1.png")}),$(".nav .switch").on("click",function(){$(this).parent().toggleClass("active")}),$(".comment-form").comment()});
//# sourceMappingURL=main.min.js.map
