!function(t){t.fn.message=function(e,n){var a="emoji";2===n?a="warning":3===n&&(a="delete");var o=t('<span class="message"><i class="iconfont icon-'+a+'"></i> '+e+"</span>");t("body").append(o),o.animate({opacity:1,top:"40%"},{duration:300,done:function(){setTimeout(function(){o.animate({opacity:0,top:"0"},{duration:500,easing:"swing",done:function(){o.remove()}})},2e3)}})}}(jQuery),$(function(){function t(){var t=this;this.listLoading=!1;var e=function(t,e){var n=function(t){var e=function(t){return""===t||null===t||void 0===t};return e(t.postId)?"参数错误":e(t.name)?"请输入昵称":e(t.mail)?"请输入邮箱":e($.trim(t.content))?"请输入内容":t.name.length<2||t.name.length>16?"昵称必须 2 到 16 位":e(t.mail)||function(t){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(t.toLowerCase())}(t.mail)?!e(t.site)&&!function(t){return/^(?:\w+:)?\/\/([^\s\.]+\.\S{2}|localhost[\:?\d]*)\S*$/.test(t)}(t.site)&&"网址格式不正确":"邮箱格式不正确"}(t);n?($().message(n),e(!1)):$.ajax({url:"/comment",method:"POST",data:t,dataType:"json",success:function(t){e(t)},error:function(){e(!1)}})},n="#comment-tool",a="#post-id",o="#parent-id",i="#author-name",s="#author-mail",r="#author-site",l="#md-editor",c="#send-comment",m="#load-editor",d=".comment-more";this.initEditor=function(){var u=null,f=$(n);if(f.length){var p=$(i),v=$(s),g=$(r);if(window.localStorage){var h=JSON.parse(window.localStorage.getItem("comment_info"));h&&(p.val(h.name),v.val(h.mail),g.val(h.site))}$(c).on("click",function(n){n.preventDefault();var i=$(this),s=i.val();i.attr("disabled",!0).val("发送中...");var r={postId:$(a).val(),parentId:$(o).val(),name:p.val(),mail:v.val(),site:g.val(),content:u&&u.getPreviewedHTML()};e(r,function(e){i.attr("disabled",!1).val(s),e&&(200===e.code?(e.info.commentCheck?$().message("评论成功，需管理员审核才能展示"):($().message("评论成功"),t.initCommentList(!0)),u.setMarkdown(""),window.localStorage&&window.localStorage.setItem("comment_info",JSON.stringify({name:r.name,mail:r.mail,site:r.site}))):$().message(e.message))})}),$(m).on("click",function(t){t.preventDefault(),$(t.currentTarget).val("正在加载编辑器..."),function(t){var e=document.createElement("link");e.type="text/css",e.rel="stylesheet",e.href="/manager/static/editor.md/css/editormd.min.css",e.onload=e.onreadystatechange=function(){t&&t()},$(e).insertAfter($("title"))}(function(){!function(t){var e=document.createElement("script");e.type="text/javascript",e.src="/manager/static/editor.md/editormd.min.js",e.onload=e.onreadystatechange=function(){t&&t()},document.body.appendChild(e)}(function(){!function(t,e){var n=window.editormd(e.replace("#",""),{width:"100%",height:150,path:"/manager/static/editor.md/lib/",placeholder:"请输入留言，支持 Markdown...",lineNumbers:!1,saveHTMLToTextarea:!0,watch:!0,toolbar:!1,taskList:!0});n.on("load",function(){t&&t(n),this.resize("200%",null)})}(function(e){$(t.currentTarget).hide(),$().message("编辑器加载成功"),$("html, body").animate({scrollTop:f.offset().top-70+"px"},{duration:500,easing:"swing"}),u=e},l)})})}),$(r).on("blur",function(){var t=$(this).val();t.length>0&&0!==t.indexOf("http://")&&0!==t.indexOf("https://")&&0!==t.indexOf("tfp://")&&$(this).val("http://"+t)}),$(d).on("click",function(){t.listLoading||(t.listLoading=!0,t.initCommentList())})}},this.initCommentList=function(e){var n=$(".comment-info");if(n.length){var a=n.attr("data-post-id"),o=n.attr("data-page"),i=$(d),s=i.text();i.text("加载中..."),e&&(o=-1),$.ajax({url:"/comment?page="+ ++o+"&postId="+a,method:"GET",dataType:"json",success:function(a){if(200===a.code){var o=a.pageSize,r=a.list,l=parseInt((a.totalCount+o-1)/o);n.attr("data-page",a.pageId),l<=a.pageId+1?i.hide():i.show(),$(".comment-info-count").text(a.totalCount);var c=$(".comment-info-list"),m=void 0;e?(c.empty(),m=0,n.attr("data-count",r.length)):(m=Number(n.attr("data-count")),n.attr("data-count",m+r.length));for(var d=0;d<r.length;d++){var u=r[d];c.append('<li class="comment-info-item" id="post-comment-'+u.post_id+'">    <div class="comment-info-box">        <div class="comment-info-row">            <a href="javascript:void(0);" class="comment-info-anchor"># '+(m+d+1)+' </a>            <span class="blod">               <a target="_blank" href="'+u.author_site+'">'+u.author+"</a>            </span>            <span>于 "+u.create_time+'</span>            <span>回复到：</span>        </div>        <div class="comment-info-row">            <div class="content markdown-body">'+u.content+"</div>        </div>    </div></li>")}}t.listLoading=!1,i.text(s)}})}}}$(".markdown-toc a").on("click",function(t){t.preventDefault();var e=decodeURI(this.href.split("#")[1]);$("html, body").animate({scrollTop:$('.reference-link[name="'+e+'"]').offset().top-70+"px"},{duration:500,easing:"swing"})}),function(){var t=$(".post-box").attr("data-post-id");$(".post-vote .post-vote-item").on("click",function(){if($(".post-vote-item i.active").length)$().message("您已投过票了！");else{var e=this,n=$(this).hasClass("unlike");$.ajax({type:"POST",url:(n?"/post/unlike/":"/post/like/")+t,success:function(t){if(200===t.code){var a=$(e).find("i"),o=n?$(".unlike-num"):$(".like-num");n?a.removeClass("icon-emoji").addClass("pink active icon-emoji_fill"):a.removeClass("icon-praise").addClass("pink active icon-praise_fill"),o.text(Number(o.eq(0).text())+1),$().message("投票成功！")}else $().message(t.message)},dataType:"json"})}})}(),$('.markdown-body a:not([class^="toc-level"])').attr("target","_blank"),$(".sidebar-op").on("click",function(){var t=$(".sidebar");t.attr("data-init")||$.ajax({method:"GET",url:"/sidebar",dataType:"json",success:function(e){if(200===e.code){var n=e.info;$(".author-ch-name").text(n.ch_name),$(".author-en-name").text(n.en_name),$(".collection-post-num").text(n.post_num),$(".collection-category-num").text(n.post_category_num),$(".collection-tag-num").text(n.post_tag_num);for(var a=$(".author-links"),o=0;o<n.links.length;o++)a.append('<a target="_blank" href="'+n.links[o].href+'">'+n.links[o].label+"</a>");var i=$(".friends-links");for(o=0;o<n.friends_links.length;o++)i.append('<a target="_blank" href="'+n.friends_links[o].href+'">'+n.friends_links[o].label+"</a>");t.attr("data-init","1")}else $.message(e.message)}}),$("body").toggleClass("sidebar-open")}),$(".sidebar .author-avatar img").on("mouseover mouseleave",function(t){$(this).attr("src","mouseover"===t.type?"/img/logo.gif":"/img/logo_1.png")}),$(".nav .switch").on("click",function(){$(this).parent().toggleClass("active")}),function(){var e=new t;e.initEditor(),e.initCommentList(!0)}()});
//# sourceMappingURL=main.min.js.map
